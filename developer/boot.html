

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Boot process &mdash; helloSystem pre-alpha documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Applications" href="applications.html" />
    <link rel="prev" title="Developer Guide" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> helloSystem
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Boot process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#live-system-early-boot-process">Live system early boot process</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting-the-live-system-early-boot-process">Troubleshooting the Live system early boot process</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boot-in-verbose-mode">Boot in verbose mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boot-into-verbose-single-user-mode">Boot into verbose single-user mode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#graphical-desktop-start-process">Graphical desktop start process</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting-the-graphical-desktop-start-process">Troubleshooting the graphical desktop start process</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installed-system-boot-process">Installed system boot process</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="applications.html">Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="building.html">Building the Live ISO</a></li>
<li class="toctree-l2"><a class="reference internal" href="distributions.html">Note to distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l2"><a class="reference internal" href="contact.html">Contact</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">helloSystem</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Developer Guide</a> &raquo;</li>
        
      <li>Boot process</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/helloSystem/docs/blob/main/developer/boot.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="boot-process">
<h1>Boot process<a class="headerlink" href="#boot-process" title="Permalink to this headline">¶</a></h1>
<div class="section" id="live-system-early-boot-process">
<h2>Live system early boot process<a class="headerlink" href="#live-system-early-boot-process" title="Permalink to this headline">¶</a></h2>
<p>The ISO contains a compressed Live system filesystem image in uzip format. This filesystem image contains the filesystem used when running the ISO. During the Live system boot process, the image needs to get mounted and needs to get turned into a read-write filesystem so that one can make changes to the running system.</p>
<p>FreeBSD does not have a standard way to achieve this, so custom code has to be used. (The ISOs provided by the FreeBSD project do not use a compressed Live system filesystem image, and do not result in a read-write filesystem when being booted.)</p>
<p>This is a simplified description of the boot process. There may be additional aspects which still need to be documented.</p>
<ol class="simple">
<li><p>The bootloader gets loaded</p></li>
<li><p>The bootloader loads the kernel modules that are required for the Live system boot process as specified in <code class="docutils literal notranslate"><span class="pre">overlays/boot/boot/loader.conf</span></code>. Note that the bootloader apparently is not smart enough to load the dependencies of kernel modules, so one needs to manually specify those as well. For example, <code class="docutils literal notranslate"><span class="pre">zfs.ko</span></code> up to FreeBSD 12 requires <code class="docutils literal notranslate"><span class="pre">opensolaris.ko</span></code> and from 13 onward requires <code class="docutils literal notranslate"><span class="pre">cryptodev.ko</span></code></p></li>
<li><p>The bootloader loads the ramdisk image <code class="docutils literal notranslate"><span class="pre">ramdisk.ufs</span></code> as specified in <code class="docutils literal notranslate"><span class="pre">overlays/boot/boot/loader.conf</span></code>. The contents of the ramdisk image are specified in <code class="docutils literal notranslate"><span class="pre">overlays/ramdisk</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">init.sh</span></code> from the ramdisk image gets executed as specified in <code class="docutils literal notranslate"><span class="pre">overlays/ramdisk/init.sh</span></code>. It constructs a r/w Live filesystem tree (e.g., by replicating the system image to swap-based memdisk) at <code class="docutils literal notranslate"><span class="pre">/livecd</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/usr/local/bin/furybsd-init-helper</span></code> gets executed by <code class="docutils literal notranslate"><span class="pre">init.sh</span></code> in a chroot of the live filesystem, <code class="docutils literal notranslate"><span class="pre">/livecd</span></code>. It is defined in <code class="docutils literal notranslate"><span class="pre">overlays/uzip/furybsd-live-settings/files/usr/local/bin/furybsd-init-helper</span></code> and deals with loading Xorg configuration based on the detected devices on PCI, and with loading virtualization-related drivers</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">/livecd</span></code> chroot is exited</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">init.sh</span></code> from the ramdisk image exits</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">etc/rc</span></code> from the ramdisk image gets executed as specified in <code class="docutils literal notranslate"><span class="pre">overlays/ramdisk/etc/rc</span></code> (by what?). It tells the kernel to “reroot” (not “chroot”) into the live filesystem, <code class="docutils literal notranslate"><span class="pre">/livecd</span></code> using <code class="docutils literal notranslate"><span class="pre">reboot</span> <span class="pre">-r</span></code>
1 From here on, the boot process is the regular FreeBSD boot process</p></li>
</ol>
<div class="section" id="troubleshooting-the-live-system-early-boot-process">
<h3>Troubleshooting the Live system early boot process<a class="headerlink" href="#troubleshooting-the-live-system-early-boot-process" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Hangs or reboots during replicating the system image to swap-based memdisk.</strong> The ISO is damaged. About one out of 10 builds of the ISO have this issue. Simply build a new ISO or wait for the next ISO to be available for download</p></li>
<li><p><strong>“Cannot mount tmpfs on /dev/reroot: Operation not supported by device”.</strong> Reason unkown. Are needed kernel modules missing?</p></li>
</ul>
</div>
<div class="section" id="boot-in-verbose-mode">
<h3>Boot in verbose mode<a class="headerlink" href="#boot-in-verbose-mode" title="Permalink to this headline">¶</a></h3>
<p>If you would like to observe the details of the boot process, you can start your computer in <strong>verbose mode</strong>. This allows you to inspect the Live system early boot process and to enter commands manually that would otherwise be executed automatically.</p>
<ol class="simple">
<li><p>For a short time during boot, it says <code class="docutils literal notranslate"><span class="pre">Hit</span> <span class="pre">[Enter]</span> <span class="pre">to</span> <span class="pre">boot</span> <span class="pre">immediately,</span> <span class="pre">or</span> <span class="pre">any</span> <span class="pre">other</span> <span class="pre">key</span> <span class="pre">for</span> <span class="pre">command</span> <span class="pre">prompt.</span></code>. Press the <strong>Esc</strong> key on your keyboard immediately when you see this</p></li>
<li><p>Type <code class="docutils literal notranslate"><span class="pre">unset</span> <span class="pre">boot_mute</span></code>  and press the <strong>Enter</strong> key. This disables the graphical splash screen</p></li>
<li><p>Type <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">console=text</span></code>  and press the <strong>Enter</strong> key. This results in boot messages being shown on screen</p></li>
<li><p>Type <code class="docutils literal notranslate"><span class="pre">boot</span> <span class="pre">-v</span></code> and press the <strong>Enter</strong> key. This results in the system being booted in verbose mode</p></li>
</ol>
<p>The computer should boot into a graphical desktop.</p>
</div>
<div class="section" id="boot-into-verbose-single-user-mode">
<h3>Boot into verbose single-user mode<a class="headerlink" href="#boot-into-verbose-single-user-mode" title="Permalink to this headline">¶</a></h3>
<p>If your computer hangs during booting, you can boot into <strong>verbose single-user mode</strong>. This allows advanced users, administrators, and developers to inspect the Live system early boot process and to enter commands manually that would otherwise be executed automatically.</p>
<ol class="simple">
<li><p>For a short time during boot, it says <code class="docutils literal notranslate"><span class="pre">Hit</span> <span class="pre">[Enter]</span> <span class="pre">to</span> <span class="pre">boot</span> <span class="pre">immediately,</span> <span class="pre">or</span> <span class="pre">any</span> <span class="pre">other</span> <span class="pre">key</span> <span class="pre">for</span> <span class="pre">command</span> <span class="pre">prompt.</span></code>. Press the <strong>Esc</strong> key on your keyboard immediately when you see this</p></li>
<li><p>Type <code class="docutils literal notranslate"><span class="pre">unset</span> <span class="pre">boot_mute</span></code>  and press the <strong>Enter</strong> key. This disables the graphical splash screen</p></li>
<li><p>Type <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">console=text</span></code>  and press the <strong>Enter</strong> key. This results in boot messages being shown on screen</p></li>
<li><p>Type <code class="docutils literal notranslate"><span class="pre">boot</span> <span class="pre">-v</span> <span class="pre">-s</span></code> and press the <strong>Enter</strong> key. This results in the system being booted in verbose single-user mode</p></li>
</ol>
<p>The computer should boot into a text console rescue system in which parts of <code class="docutils literal notranslate"><span class="pre">init.sh</span></code> from the ramdisk image have run.</p>
</div>
</div>
<div class="section" id="graphical-desktop-start-process">
<h2>Graphical desktop start process<a class="headerlink" href="#graphical-desktop-start-process" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>The system is configured in <code class="docutils literal notranslate"><span class="pre">/etc/rc.conf</span></code> to start the <code class="docutils literal notranslate"><span class="pre">slim</span></code> login manager. This also results in Xorg being started</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">slim</span></code> is configured in <code class="docutils literal notranslate"><span class="pre">/usr/local/etc/slim.conf</span></code> to start <code class="docutils literal notranslate"><span class="pre">start-hello</span></code> once the user has logged in, or if autologin has occured</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">/usr/local/bin/start-hello</span></code> shell script starts the various components of the helloSystem desktop</p></li>
</ol>
<div class="section" id="troubleshooting-the-graphical-desktop-start-process">
<h3>Troubleshooting the graphical desktop start process<a class="headerlink" href="#troubleshooting-the-graphical-desktop-start-process" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Login manager (<code class="docutils literal notranslate"><span class="pre">slim</span></code>) says <strong>Failed to execute login command</strong>. Check the <code class="docutils literal notranslate"><span class="pre">/usr/local/bin/start-hello</span></code> shell script.</p></li>
</ul>
</div>
</div>
<div class="section" id="installed-system-boot-process">
<h2>Installed system boot process<a class="headerlink" href="#installed-system-boot-process" title="Permalink to this headline">¶</a></h2>
<p>The boot process is the regular FreeBSD boot process. Please refer to <a class="reference external" href="https://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/boot.html">The FreeBSD Booting Process</a> for more information.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="applications.html" class="btn btn-neutral float-right" title="Applications" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Developer Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, probono

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>